#this is working
- name: Create GitRep folder
  ansible.builtin.win_file:
     state: directory
     recurse: true
     path: C:\GitRep
     tags:
       - git

- name: Installing Chocolatey
  raw: |
    Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
  become: true
  ignore_errors: yes
  tags:
    - git

- name: Installing git
  win_chocolatey:
    name: git
    state: present
    
- name: Cloning Git repository teamproject
  win_shell: git clone ssh://teamproject.git C:\\GitRep\\skynet
  become: yes
  tags:
     - git

- name: Running poetry install on teamproject
  win_command: poetry install
  args:
    chdir: C:\GitRep\teamproject
  ignore_errors: yes
  tags:
    - git

- name: Cloning Git repository teamproject2
  win_shell: git clone ssh://teamproject2/aurora.git C:\\GitRep\\aurora
  become: yes
  tags:
    - git

- name: Running poetry install on teamproject2
  win_command: poetry install
  args:
    chdir: C:\GitRep\teamproject2
  ignore_errors: yes
  tags:
    - git


- name: Setting WORK_DIR environment variable for Git
  win_environment:
    name: WORK_DIR
    value: "C:\\GitRep"
    state: present
    level: user
  tags:
    - git
